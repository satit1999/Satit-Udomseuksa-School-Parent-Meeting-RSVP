# คู่มือการเชื่อมต่อฐานข้อมูล Google Sheet

เอกสารนี้จะแนะนำขั้นตอนการตั้งค่า Google Sheet เพื่อใช้เป็นฐานข้อมูลสำหรับฟอร์มตอบรับการเข้าร่วมประชุมผู้ปกครอง

---

### ขั้นตอนที่ 1: สร้าง Google Sheet

1.  ไปที่ [sheets.google.com](https://sheets.google.com) และสร้างเอกสารใหม่ (Blank spreadsheet)
2.  ตั้งชื่อไฟล์ตามที่คุณต้องการ เช่น "Parent Meeting RSVP"
3.  เปลี่ยนชื่อชีตด้านล่างจาก "Sheet1" เป็น **`Submissions`** (สำคัญมาก ต้องเป็นชื่อนี้เท่านั้น)

---

### ขั้นตอนที่ 2: ตั้งค่าหัวตาราง (Header) - รูปแบบใหม่

เพื่อให้ข้อมูลเป็นระเบียบและง่ายต่อการจัดการ เราจะเก็บข้อมูลผู้ปกครองและนักเรียนแต่ละคนในคอลัมน์แยกกัน **กรุณาตั้งค่าหัวตารางในแถวแรกของชีต `Submissions` ให้ตรงตามลำดับนี้ทุกประการ:**

| คอลัมน์ | หัวข้อ (Header)       | คำอธิบาย                                |
| :------- | :-------------------- | :-------------------------------------- |
| A        | `id`                  | ID ของการลงทะเบียน (ห้ามแก้ไข)          |
| B        | `parent1_title`       | คำนำหน้าชื่อผู้ปกครองคนที่ 1              |
| C        | `parent1_fullName`    | ชื่อ-สกุลผู้ปกครองคนที่ 1                |
| D        | `parent1_phone`       | เบอร์โทรศัพท์ผู้ปกครองคนที่ 1             |
| E        | `parent2_title`       | คำนำหน้าชื่อผู้ปกครองคนที่ 2              |
| F        | `parent2_fullName`    | ชื่อ-สกุลผู้ปกครองคนที่ 2                |
| G        | `parent2_phone`       | เบอร์โทรศัพท์ผู้ปกครองคนที่ 2             |
| H        | `parent3_title`       | คำนำหน้าชื่อผู้ปกครองคนที่ 3              |
| I        | `parent3_fullName`    | ชื่อ-สกุลผู้ปกครองคนที่ 3                |
| J        | `parent3_phone`       | เบอร์โทรศัพท์ผู้ปกครองคนที่ 3             |
| K        | `student1_title`      | คำนำหน้าชื่อนักเรียนคนที่ 1              |
| L        | `student1_fullName`   | ชื่อ-สกุลนักเรียนคนที่ 1                 |
| M        | `student1_program`    | โปรแกรมการเรียนนักเรียนคนที่ 1           |
| N        | `student1_className`  | ห้องเรียนนักเรียนคนที่ 1                 |
| O        | `student2_title`      | คำนำหน้าชื่อนักเรียนคนที่ 2              |
| P        | `student2_fullName`   | ชื่อ-สกุลนักเรียนคนที่ 2                 |
| Q        | `student2_program`    | โปรแกรมการเรียนนักเรียนคนที่ 2           |
| R        | `student2_className`  | ห้องเรียนนักเรียนคนที่ 2                 |
| S        | `student3_title`      | คำนำหน้าชื่อนักเรียนคนที่ 3              |
| T        | `student3_fullName`   | ชื่อ-สกุลนักเรียนคนที่ 3                 |
| U        | `student3_program`    | โปรแกรมการเรียนนักเรียนคนที่ 3           |
| V        | `student3_className`  | ห้องเรียนนักเรียนคนที่ 3                 |
| W        | `attendance`          | สถานะการเข้าร่วม                        |
| X        | `submissionDate`      | วันที่และเวลาที่ส่งข้อมูล               |


---

### ขั้นตอนที่ 3: สร้าง Google Apps Script

1.  ในหน้าต่าง Google Sheet ของคุณ ไปที่เมนูด้านบน `Extensions` > `Apps Script`
2.  หน้าต่างใหม่จะเปิดขึ้นมา เป็นหน้าสำหรับเขียนโค้ด
3.  ลบโค้ดที่มีอยู่ทั้งหมดในไฟล์ `Code.gs`

---

### ขั้นตอนที่ 4: เพิ่มโค้ดลงใน Script

1.  คัดลอกโค้ดทั้งหมดจากไฟล์ `google-apps-script.js` ที่อยู่ในโปรเจกต์ของคุณ
2.  นำโค้ดที่คัดลอกมาไปวางในไฟล์ `Code.gs` ที่ว่างเปล่า
3.  กดไอคอนรูปแผ่นดิสก์ (Save project) เพื่อบันทึก

---

### ขั้นตอนที่ 5: Deploy Script เป็น Web App

1.  ที่มุมบนขวาของหน้าต่าง Apps Script คลิกที่ปุ่มสีน้ำเงิน **`Deploy`** > **`New deployment`**
2.  จะปรากฏหน้าต่างตั้งค่าขึ้นมา:
    *   คลิกที่ไอคอนรูปเฟือง (⚙️) ข้างๆ "Select type" และเลือก **`Web app`**
    *   ในช่อง `Description` (คำอธิบาย) คุณสามารถใส่ข้อความอะไรก็ได้ เช่น "RSVP Form API v2"
    *   ในช่อง `Execute as` (เรียกใช้งานเป็น) ให้เลือก **`Me`** (บัญชี Google ของคุณ)
    *   ในช่อง `Who has access` (ผู้ที่มีสิทธิ์เข้าถึง) ให้เลือก **`Anyone`** (ทุกคน) **(สำคัญมาก! เพื่อให้ฟอร์มสาธารณะสามารถส่งข้อมูลได้)**
3.  คลิกที่ปุ่ม **`Deploy`**

---

### ขั้นตอนที่ 6: ให้สิทธิ์การเข้าถึง และคัดลอก Web App URL

1.  หลังจากกด Deploy อาจมีหน้าต่างขอสิทธิ์การเข้าถึง (Authorization Required)
2.  คลิก **`Authorize access`**
3.  เลือกบัญชี Google ของคุณ
4.  อาจมีหน้าจอเตือนว่า "Google hasn’t verified this app" ให้คลิกที่ **`Advanced`** (ขั้นสูง) แล้วคลิกที่ **`Go to [ชื่อโปรเจกต์ของคุณ] (unsafe)`**
5.  คลิก **`Allow`** (อนุญาต) เพื่อให้สิทธิ์สคริปต์เข้าถึง Google Sheet ของคุณ
6.  เมื่อ Deploy สำเร็จ จะมีหน้าต่างแสดง **`Web app URL`** ขึ้นมา ให้คลิกปุ่ม **`Copy`** เพื่อคัดลอก URL นี้เก็บไว้

**หมายเหตุ:** ทุกครั้งที่คุณแก้ไขโค้ดใน Apps Script คุณจะต้อง Deploy ใหม่โดยไปที่ `Deploy` > `Manage deployments` > เลือก deployment ของคุณ > กดไอคอนดินสอ (Edit) > เลือก `Version: New version` > แล้วกด `Deploy` อีกครั้ง

---

### ขั้นตอนที่ 7: นำ URL ไปใส่ในโปรเจกต์

1.  เปิดไฟล์ `config.ts` ในโปรเจกต์ของคุณ
2.  คุณจะเห็นโค้ดลักษณะนี้:
    ```typescript
    export const SCRIPT_URL = 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE';
    ```
3.  นำ URL ที่คุณคัดลอกมาจากขั้นตอนที่ 6 ไปวางแทนที่ `'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE'`

    **ตัวอย่าง:**
    ```typescript
    export const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby.../exec';
    ```
4.  บันทึกไฟล์

**เสร็จสิ้น!** ตอนนี้แอปพลิเคชันของคุณพร้อมที่จะเชื่อมต่อกับ Google Sheet แล้ว ข้อมูลที่ส่งจากฟอร์มจะถูกบันทึกลงในชีตโดยอัตโนมัติ และหน้า Admin Dashboard ก็จะดึงข้อมูลจากชีตมาแสดงผล